package parser

import (
	"bitbucket.org/stack-rox/apollo/central/apitoken/signer"
	"bitbucket.org/stack-rox/apollo/central/role/store"
	"bitbucket.org/stack-rox/apollo/pkg/auth/tokenbased"
)

// A Parser parses (and validates) API tokens.
type Parser interface {
	tokenbased.IdentityParser
	ParseToken(token string) (tokenbased.Identity, error)
}

// A tokenRevocationChecker can check for token revocation
type tokenRevocationChecker interface {
	CheckTokenRevocation(id string) error
}

// New returns a new identity parser that parses API tokens generated by Central.
func New(signer signer.Signer, roleStore store.Store, revocationChecker tokenRevocationChecker) Parser {
	return &parserImpl{
		signer:            signer,
		roleStore:         roleStore,
		revocationChecker: revocationChecker,
	}
}
